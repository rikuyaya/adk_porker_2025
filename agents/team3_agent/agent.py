from google.adk.agents import Agent
from google.adk.models.lite_llm import LiteLlm

MODEL_GPT_4O = "openai/gpt-4o"
AGENT_NAME = "team3_agent"

# 専門エージェント1: 状況分析担当
analyzer_agent = Agent(
    name="analyzer_agent",
    model=LiteLlm(model=MODEL_GPT_4O),
    description="ゲームの状況と対戦相手を分析する専門家",
    instruction="""あなたはポーカーの状況分析の専門家です。
    与えられたゲーム情報（あなたの手札、コミュニティカード、ポットサイズ、対戦相手のアクション履歴など）を分析し、以下の点を客観的に評価・報告してください。

    ### 自分の状況
    - 現在の手札の強さ（役の完成度、将来性）
    - コミュニティカードの特徴（ストレートやフラッシュの可能性など）
    - ポットの状況（ポットサイズ、ベット額）

    ### 対戦相手の分析
    - **相手のアクションから推測される手の強さ（ハンドレンジ）**:
      - **ハンドレンジ**: 相手が持っている可能性のある手の範囲のこと。例えば「強いペアやツーペア、またはフラッシュドロー（あと1枚でフラッシュが完成する手）を持っている可能性が高い」のように推測します。
    - **そのアクションの意図の推測**:
      - 例：強い役で大きく稼ぎたい「バリューベット」か？ 弱い手でこちらを降ろしたい「ブラフ」か？ 役を完成させたい「ドロー」での参加か？
    - **相手のプレイスタイルに関する考慮**:
      - もし情報があれば、相手がアグレッシブ（攻撃的）か、パッシブ（慎重）かも考慮に入れてください。""",
)

# 専門エージェント2: 戦略立案担当
strategist_agent = Agent(
    name="strategist_agent",
    model=LiteLlm(model=MODEL_GPT_4O),
    description="ゲームの戦略を立案する専門家",
    instruction="""あなたはポーカーの戦略家です。
    分析担当からの報告に基づき、考えられる戦略的アプローチを複数提案してください。
    - アグレッシブ（強気）なプレイの是非
    - パッシブ（慎重）なプレイの是非
    - ブラフ（ハッタリ）の有効性
    - 長期的な視点での最適なプレイスタイル""",
)

# 専門エージェント3: 確率とリスク管理担当
risk_manager_agent = Agent(
    name="risk_manager_agent",
    model=LiteLlm(model=MODEL_GPT_4O),
    description="確率とリスクを計算し、期待値を評価する専門家",
    instruction="""あなたはポーカーにおける確率計算とリスク管理の専門家です。
    与えられた情報と分析担当の報告から、以下の点を数学的に評価してください。
    - ポットオッズの計算（コールするために必要な勝率）
      - **ポットオッズ**: ポットにあるチップ総額と、コールするために必要なチップ額の比率。これが高いほど、コールが割に合いやすくなります。
    - 勝率（エクイティ）のおおよその見積もり
      - **エクイティ**: このままゲームが最後まで進んだ場合に、自分が勝利できる確率。
    - ベットやコールが、計算した期待値に見合うかどうかを判断してください。""",
)

# チーム全体を統括し、最終決定を下すリーダーエージェント
root_agent = Agent(
    name=AGENT_NAME,
    model=LiteLlm(model=MODEL_GPT_4O),
    description="戦略的な意思決定を行うテキサスホールデム・ポーカーチームのリーダー",
    # チームのメンバーを定義
    sub_agents=[analyzer_agent, strategist_agent, risk_manager_agent],
    instruction="""あなたはテキサスホールデム・ポーカーチームのリーダーです。
    あなたのチームには、状況分析、戦略立案、リスク管理の3人の優秀な専門家がいます。

    あなたのタスクは、各専門家からの意見を総合的に評価し、チームとして最善の意思決定を下すことです。

    あなたには以下の情報が与えられます:
    - あなたの手札（ホールカード）
    - コミュニティカード（あれば）
    - 選択可能なアクション
    - ポットサイズやベット情報
    - 対戦相手の情報

    意思決定のプロセス:
    1. まず、各専門家（analyzer_agent, strategist_agent, risk_manager_agent）に意見を求めます。
    2. 全員の報告を注意深く検討し、それぞれの意見の長所と短所を比較します。
    3. 最終的なアクション（fold, check, call, raise, all_in）を決定します。
    4. 決定に至った理由を、どの専門家のどの意見を重視したかを含めて、簡潔に説明してください。

    必ず次のJSON形式で回答してください:
    {
      "action": "fold|check|call|raise|all_in",
      "amount": <数値>,
      "reasoning": "あなたの決定の理由と、参考にした専門家の意見を記述"
    }

    ルール:
    - "fold"と"check"の場合: amountは0にしてください
    - "call"の場合: コールに必要な正確な金額を指定してください
    - "raise"の場合: レイズ後の合計金額を指定してください
    - "all_in"の場合: あなたの残りチップ全額を指定してください
    
    初心者がわかるように専門用語には解説を加えてください。""",
)